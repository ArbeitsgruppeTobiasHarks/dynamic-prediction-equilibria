\subsection{Dynamic Prediction Equilibrium}\label{subsec-dynamic-prediction-equilibrium}

To enable a game theoretic perspective on dynamic flows, the infinitesimally small particles are interpreted as agents belonging to a commodity $i\in I$.
An agent gets generated at some time at the source node $s_i$.
Each time an agent arrives at a node, it can update its route based on historical traffic data of the network.
More specifically, each commodity has its own prediction method to predict future queue lengths on all edges of the network.
Based on the predicted queue lengths an agent now determines a time-dependent shortest path starting from his current position to $t_i$.

More formally, for a commodity $i\in I$ the \emph{predicted queue length} of an edge $e$ at time $\theta$ as predicted at time $\bar\theta$ based on the historical queue lengths $q=(q_e)_{e\in E}$ is given by $\predq_{i,e}(\theta, \bar\theta, q)$.
Aside from the predicted queue lengths all other predicted values will be denoted with a hat. 
This means, each commodity $i$ has a set of predictor functions $(\predq_{i,e})_{e\in E}$ each of which has the following the signature:
\[
    \predq_{i,e} : \R_{\geq 0} \times \R_{\geq 0} \times \contFcts{\R_{\geq 0}}{\R_{\geq 0}}^E \rightarrow \R_{\geq0},
\]
where $\contFcts{A}{B}$ denotes the set of all continuous functions from $A$ to $B$.

Based on the predicted queue lengths we can also determine \emph{predicted queue costs} by \[
    \predc_{i,e}(\theta, \bar\theta, q) \coloneqq \transit_e + \frac{\predq_{i,e}(\theta, \bar\theta, q)}{\capa_e}.
\]
The \emph{predicted traversal time of an edge $e=vw$} is the predicted arrival time at $w$ when entering edge $e$ at time $\theta$ defined as $\predT_{i,e}(\theta, \bar\theta, q) \coloneqq \theta + \predc(\theta, \bar\theta, q)$.
The \emph{predicted traversal time of a path $P=e_1\,e_2\,\cdots\,e_k$} is thus defined as \[
    \predT_{i,P}(\theta,\bar\theta, q) \coloneqq \left(
        \predT_{i,e_k}(\emptyArg, \bar\theta, q) \circ \cdots \circ \predT_{i,e_1}(\emptyArg, \bar\theta, q)
    \right) (\theta).
\]

For all nodes $v$ that can reach $t_i$, we denote the set of all simple $v$-$t_i$-paths as $\paths_{v,t_i}$.
We can then determine the \emph{predicted earliest arrival time} at $t_i$ when starting in $v$ at time $\theta$ by
\[
    \predl_{i,v}(\theta, \bar\theta, q) \coloneqq \min_{P \in \paths_{v,t_i}} \predT_{i, P}(\theta,\bar\theta, q).
\]
We call a path that attains this minimum a \emph{$\bar\theta$-predicted shortest $v$-$t_i$-path at time $\theta$}.
Before we continue, we want to make sure, that this definition of shortest-paths is sensible:
We can only restrict ourselves to simple paths, if waiting at a node, or traveling through a short cycle, is never helpful.
This can be realized by assuming the FIFO-property of predictors:
\begin{definition}
    A set of predictors $(\predq_{i,e})_{e\in E}$ \emph{follows the FIFO rule} if $(\predc_{i,e}(\emptyArg, \bar\theta, q))_{e\in E}$ follows the FIFO-rule for all $\bar\theta\in\R_{\geq0}, q\in\contFcts{\R_{\geq0}}{\R_{\geq0}}$.
\end{definition}

We recall, that for predictors following the FIFO rule, the results from Section~\ref{sec:fifo-costs} apply, and we have $\predl_{i,v}(\theta, \bar\theta, q) \leq \predl_{i,w}{(
    \predT_{i, e}(\theta, \bar\theta, q)
)}$
for all $v\in V_i$ and $e=vw\in E$.

\begin{definition}
An edge $e=vw$ is called \emph{active} for commodity $i\in I$ at time $\theta\in\R$ as predicted at time~$\bar\theta$, if the equation \[
    \predl_{i,v}(\theta, \bar\theta, q) = \predl_{i,w}{\left(
        \predT_{i, e}(\theta, \bar\theta, q)
    \right)}
\]
holds true.
All edges for commodity $i$ that are active at time $\theta$ as predicted at $\bar\theta$ are collected in the set $\predE_i(\theta, \bar\theta, q)$. 
\end{definition}

We can now define an equilibrium based on these predictors, in which all agents only take shortest paths at all times based on their current prediction.
\begin{definition}
    A pair $(\predq, f)$ of a set of predictors $(\predq_{i,e})_{i\in I, e\in E}$ and a dynamic flow $f$ is a \emph{partial dynamic prediction equilibrium up to time $H\in\R\cup\{\infty\}$} if $f$ is feasible up to time $H$ and for all $e\in E, i\in I$ and $\theta < H$ it holds that
    \[
        \infl_{i,e}(\theta) > 0 \implies e \in \predE_i(\theta, \theta, q).
    \]
    For $H = \infty$ the pair $(\predq, f)$ is called \emph{dynamic prediction equilibrium (DPE)}. 
\end{definition}

In other words, a pair of a set of predictors and a flow is a DPE, if whenever flow enters an edge at some time $\theta$, then the prediction of that commodity evaluated at the same time $\theta$ says, that the edge lies on a dynamic shortest path to $t_i$.

\subsection{Applied Predictors}

\todo[inline]{
    Write about all the applied predictors
}